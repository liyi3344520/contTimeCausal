{
    "contents" : "---\n  output: github_document\n---\n\n<!-- rmarkdown v1 -->\n\n<!-- README.md is generated from README.Rmd. Please edit that file -->\n\n```{r, echo = FALSE}\nknitr::opts_chunk$set(\n  collapse = TRUE,\n  comment = \"#>\",\n   fig.path = \"README-\"\n  #  fig.path = \"man/figures/README-\"\n)\n```\n\n# Continuous time causal models\n\n\n### Continuous-time Causal Models for evaluating the effect of time-varying treatments  \n\n### Visit the [package website](https://github.com/shuyang1987/contTimeCausal)\n\n## Description\n\nThe Cox MSM assumes that the potential failure time \\eqn{T^{\\overline{a}}} under the treatment \\eqn{\\overline{a}} follows a proportional hazards model with \\eqn{\\psi*a_u}.\nWe assume that the individual continuously received treatment until time \\eqn{V}.\nThe observed failure time can be censored assuming the censoring time is independent of the failure time given the treatment and covariate history (the so-called ignorable censoring).\nThe current function provides a template to handle one-dimensional baseline covariate and one-dimensional time-dependent covariate;\nextension to handling multiple baseline  and  time-dependent covariates is possible.\nVariance estimate should be implemented by delete-one-group jackknifing and recalling ctCoxMSM.\n\n\n\n### Main Paper: Yang et al. (2019) \n\nYang, S., K. Pieper, and F. Cools. (2019) Semiparametric estimation of structural failure time model in continuous-time processes. https://arxiv.org/abs/1808.06408\n\nYang, S., A. A. Tsiatis, and M. Blazing (2018). Modeling survival distribution as a function of time to treatment discontinuation: a dynamic treatment regime approach, *Biometrics*,\n 72, 1055--1065. https://onlinelibrary.wiley.com/doi/abs/10.1111/biom.12845\n\n\n## Installation with `devtools`:\n\n```{r, eval = FALSE}\ndevtools::install_github(\"shuyang1987/conTimeCausal\")\n```\n\n\n## Use\n\nctSFTM()   estimates the effect of treatment effect for a survival outcome under a SFTM with time-varying treatment and confounding in the presence of dependent censoring.\n\nctCoxMSM() estimates the effect of treatment effect for a survival outcome under a Cox proportional hazards model with time-varying treatment and confounding in the presence of dependent censoring.\n\n\n### Toy example\n\n```{r}\nlibrary(\"survival\")\nlibrary(\"MASS\")\nlibrary(\"zoo\")\n\n set.seed(seed=11)\n n=1000\n\n ## generate time-indept covariate\n\n Lti<-rbinom(n,1,0.55)\n Lti<-Lti-mean(Lti)\n\n ## generate time-dept covariate\n\n Sigma<-matrix(0,3,3)\n for(i in 1:3){\n   for(j in 1:3){\n     Sigma[i,j]<-0.7^(abs(i-j))\n   }\n }\n\n ## Vtd represents the values of covariate at times t1=0, t2=5, and t3=10.\n ## We assume that the time-dependent variable remains constant between measurements.\n\n Vtdtemp<-mvrnorm(n = n, rep(0,3), Sigma)\n Vtd<-Vtdtemp\n t<-c(0,5,10,100)\n colnames(Vtd)<-paste(\"t\",1:3,sep=\"\")\n\n ## generate time-to-events\n ## D =time to death if never stop treatment (time-indep Cox)\n ## V =time to discontinuity (time-dep Cox)\n ## avoiding the same time points for V and U\n\n ## generate D according to an exp distribution\n\n D<-rexp(n=n,0.2)\n\n Vtd<-Vtdtemp+ matrix((D-20)/5,n,3,byrow=FALSE)\n colnames(Vtd)<-paste(\"t\",1:3,sep=\"\")\n\n ## generate V according to a tme-dept Cox using Bender et al (2005)\n\n lambdaV <- 0.15;  betaV <- c(0.15,0.15)\n\n v  <- runif(n=n)\n temp1 <- (- log(1-v) / (lambdaV * exp(cbind(Lti,Vtd[,1]) %*% betaV)))\n v  <- runif(n=n)\n temp2 <- (- log(1-v) / (lambdaV * exp(cbind(Lti,Vtd[,2]) %*% betaV)))\n v  <- runif(n=n)\n temp3 <- (- log(1-v) / (lambdaV * exp(cbind(Lti,Vtd[,3]) %*% betaV)))\n id1<-(temp1 < t[2])\n id2<-(temp2 < (t[3]-t[2]))\n id3<-(temp3 < (t[4]-t[3]))\n V2<- id1*temp1 + (1-id1)*id2*(temp2+t[2]) + (1-id1)*(1-id2)*(temp3+t[3])\n\n ## generate Tv according to a SFTM\n psi<- 0\n true<-exp(psi)\n\n id1<-D<=V2\n T.temp11<-D*exp(-psi[1])\n\n id11<-T.temp11<=V2\n id12<-T.temp11>V2\n T.temp12<-D + V2-exp(psi[1])*V2\n\n id2<-D>V2\n T.temp2<-D + V2-exp(psi[1])*V2\n\n Tv<-id11*T.temp11+id12*T.temp12\n\n ## generate censoring according to time-dept Cox\n ## nu=time to censoring\n\n lambdaC <- 0.025; betaC <- c(0.15,0.15)\n\n v  <- runif(n=n)\n temp3 <- (- log(1-v) / (lambdaC * exp(cbind(Lti,1) %*% betaC)))\n v  <- runif(n=n)\n temp4 <- (- log(1-v) / (lambdaC * exp(cbind(Lti,0) %*% betaC)))\n id3<-(temp3 < V2)\n nu<- id3*temp3 + (1-id3)*(V2+temp4)\n\n check1<-sort( c(V2, apply(cbind(Tv,nu),1,min)))\n check2<-c(check1,9999)-c(0,check1)\n\n if(min(check2)<10^-6){\n   print(\"Please re-generate the data in order to avoid the same time points for V and U\")\n }\n\n U<-apply( cbind(Tv,nu) ,1,min)\n deltaD <- ( U<nu )\n deltaV<-(V2<U)&(V2<nu)\n V<-apply(cbind(V2,U,nu),1,min)\n\n ## time-dependent covariate\n ## Ltd4Vtime is a n x ltimeV matrix consisting of the time-dependent cov\n ## each row represents each indiviudal\n ## columns represent ordered V times (the realized treatment discontinuation times)\n\n data1<-list(time=V,status=deltaV)\n fit<-coxph(Surv(time, status) ~ . , data1)\n ss<-survfit(fit)\n obsV.times<-ss$time\n ltime<-length(obsV.times)\n\n id1<- (obsV.times < t[2])\n id2<-((obsV.times < t[3])&(obsV.times > t[2]))\n id3<- (obsV.times > t[3])\n Ltd4Vtime<-matrix(NA,nrow=n,ncol=ltime)\n Ltd4Vtime[,which(id1==1)]<-Vtd[,1]\n Ltd4Vtime[,which(id2==1)]<-Vtd[,2]\n Ltd4Vtime[,which(id3==1)]<-Vtd[,3]\n\n ## Ltd4Utime is a n x ltimeU matrix consisting of the time-dependent cov\n ## each row represents each indiviudal\n ## columns represent ordered U times (the realized event times)\n\n data2<-list(time=U,status=1-deltaD)\n fit<-coxph(Surv(time, status) ~ . , data2)\n ss<-survfit(fit)\n obsU.times<-ss$time[ss$n.event==1]\n ltimeU<-length(obsU.times)\n id1<- (obsU.times < t[2])\n id2<-((obsU.times < t[3])&(obsU.times > t[2]))\n id3<- (obsU.times > t[3])\n Ltd4Utime<-matrix(NA,nrow=n,ncol=ltimeU)\n Ltd4Utime[,which(id1==1)]<-Vtd[,1]\n Ltd4Utime[,which(id2==1)]<-Vtd[,2]\n Ltd4Utime[,which(id3==1)]<-Vtd[,3]\n\n true\n contTimeCausal::ctSFTM(V,deltaV,U,deltaD,Lti,Ltd4Vtime,Ltd4Utime)$est\n contTimeCausal::ctCoxMSM(V,deltaV,U,deltaD,Lti,Ltd4Vtime,Ltd4Utime)$est\n```\n\n\n",
    "created" : 1550284134852.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3623942872",
    "id" : "BBD2FA39",
    "lastKnownWriteTime" : 1550287538,
    "path" : "~/contTimeCausal/README.Rmd",
    "project_path" : "README.Rmd",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_markdown"
}